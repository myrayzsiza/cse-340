<%- include('../partials/header') %>
<div class="container my-5">
  <div class="row">
    <div class="col-md-12">
      <div class="card">
        <div class="card-header bg-warning text-dark">
          <h3>Pending Reviews</h3>
        </div>
        <% if (reviews && reviews.length > 0) { %>
          <div class="table-responsive">
            <table class="table table-striped mb-0">
              <thead class="table-dark">
                <tr>
                  <th>Review ID</th>
                  <th>Vehicle</th>
                  <th>User</th>
                  <th>Rating</th>
                  <th>Review</th>
                  <th>Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <% reviews.forEach(review => { %>
                  <tr id="review-<%= review.review_id %>">
                    <td><%= review.review_id %></td>
                    <td><%= review.inv_year %> <%= review.inv_make %> <%= review.inv_model %></td>
                    <td><%= review.account_firstname %> <%= review.account_lastname %></td>
                    <td>
                      <span class="badge bg-primary">
                        <%= 'â˜…'.repeat(review.rating) %>
                      </span>
                    </td>
                    <td><small><%= review.review_text.substring(0, 50) %>...</small></td>
                    <td><%= new Date(review.created_at).toLocaleDateString() %></td>
                    <td>
                      <button
                        class="btn btn-success btn-sm"
                        onclick="approveReview(<%= review.review_id %>)"
                      >
                        Approve
                      </button>
                      <button
                        class="btn btn-danger btn-sm"
                        onclick="deleteReview(<%= review.review_id %>)"
                      >
                        Reject
                      </button>
                    </td>
                  </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
        <% } else { %>
          <div class="card-body">
            <div class="alert alert-success mb-0">No pending reviews.</div>
          </div>
        <% } %>
      </div>
    </div>
  </div>
</div>

<script>
  function approveReview(reviewId) {
    fetch(`/reviews/${reviewId}/approve`, {
      method: "POST",
    })
      .then((response) => response.json())
      .then((result) => {
        if (result.success) {
          document.getElementById(`review-${reviewId}`).remove();
          alert("Review approved!");
        } else {
          alert("Error: " + result.message);
        }
      })
      .catch((error) => {
        console.error("Error:", error);
        alert("An error occurred");
      });
  }

  function deleteReview(reviewId) {
    if (confirm("Are you sure you want to delete this review?")) {
      fetch(`/reviews/${reviewId}`, {
        method: "DELETE",
      })
        .then((response) => response.json())
        .then((result) => {
          if (result.success) {
            document.getElementById(`review-${reviewId}`).remove();
            alert("Review deleted!");
          } else {
            alert("Error: " + result.message);
          }
        })
        .catch((error) => {
          console.error("Error:", error);
          alert("An error occurred");
        });
    }
  }
</script>
<%- include('../partials/footer') %>
